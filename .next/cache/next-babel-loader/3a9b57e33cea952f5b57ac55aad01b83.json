{"ast":null,"code":"var __jsx = React.createElement;\nimport React from 'react';\nimport { Segment } from 'semantic-ui-react';\nimport CartItemList from '../components/Cart/CartItemList';\nimport CartSummary from '../components/Cart/CartSummary';\nimport { parseCookies } from 'nookies';\nimport axios from 'axios';\nimport cookie from 'js-cookie';\nimport baseUrl from '../utils/baseUrl';\nimport catchErrors from '../utils/catchErrors';\n\nfunction Cart({\n  products,\n  user\n}) {\n  const [cartProducts, setCartProducts] = React.useState(products);\n  const [success, setSuccess] = React.useState(false);\n  const [loading, setLoading] = React.useState(false);\n\n  async function handleRemoveFromCart(productId) {\n    const url = `${baseUrl}/api/cart`;\n    const token = cookie.get('token');\n    const payload = {\n      params: {\n        productId\n      },\n      headers: {\n        Authorization: token\n      }\n    };\n    const response = await axios.delete(url, payload);\n    setCartProducts(response.data);\n  }\n\n  async function handleCheckout(paymentData) {\n    try {\n      setLoading(true);\n      const url = `${baseUrl}/api/checkout`;\n      const token = cookie.get('token');\n      const payload = {\n        paymentData\n      };\n      const headers = {\n        headers: {\n          Authorization: token\n        }\n      };\n      await axios.post(url, payload, headers);\n      setSuccess(true);\n    } catch (error) {\n      catchErrors(error, window.alert);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  return __jsx(Segment, {\n    loading: loading\n  }, __jsx(CartItemList, {\n    handleRemoveFromCart: handleRemoveFromCart,\n    user: user,\n    products: cartProducts,\n    success: success\n  }), __jsx(CartSummary, {\n    products: cartProducts,\n    handleCheckout: handleCheckout,\n    success: success\n  }));\n}\n\nCart.getInitialProps = async ctx => {\n  const {\n    token\n  } = parseCookies(ctx);\n\n  if (!token) {\n    return {\n      products: []\n    };\n  }\n\n  const url = `${baseUrl}/api/cart`;\n  const payload = {\n    headers: {\n      Authorization: token\n    }\n  };\n  const response = await axios.get(url, payload);\n  return {\n    products: response.data\n  };\n};\n\nexport default Cart;","map":null,"metadata":{},"sourceType":"module"}